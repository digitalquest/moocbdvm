<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
<title>Manuel de la Box Vagrant du MOOC BD</title>
<!-- 2014-08-21 jeu. 10:58 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Stéphane Germain, Olivier Berger" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Manuel de la Box Vagrant du MOOC BD</h1>
<div id="table-of-contents">
<h2>Table des matières</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. TL/DR;</a></li>
<li><a href="#sec-2">2. Introduction</a>
<ul>
<li><a href="#sec-2-1">2.1. Contexte : Travail Personnel dans le MOOC BD</a></li>
<li><a href="#sec-2-2">2.2. Environnement de travail virtualisé</a></li>
<li><a href="#sec-2-3">2.3. Compétences requises</a></li>
<li><a href="#sec-2-4">2.4. Avertissement</a></li>
<li><a href="#sec-2-5">2.5. Glossaire</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Installation</a>
<ul>
<li><a href="#sec-3-1">3.1. Prérequis</a></li>
<li><a href="#sec-3-2">3.2. Télécharger et installer Vagrant et VirtualBox</a></li>
<li><a href="#sec-3-3">3.3. Initialisation et mise en route</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Utilisation</a>
<ul>
<li><a href="#sec-4-1">4.1. Lancement de la machine virtuelle</a></li>
<li><a href="#sec-4-2">4.2. Exerciseur de requêtes SQL</a></li>
<li><a href="#sec-4-3">4.3. Module Web d'administration PostgreSQL <i>phpPgAdmin</i></a>
<ul>
<li><a href="#sec-4-3-1">Requêtage</a></li>
<li><a href="#sec-4-3-2">Mises à jour</a></li>
<li><a href="#sec-4-3-3">Administration</a></li>
</ul>
</li>
<li><a href="#sec-4-4">4.4. En ligne de commande PostgreSQL</a></li>
<li><a href="#sec-4-5">4.5. Programmation Web / BD en PHP</a>
<ul>
<li><a href="#sec-4-5-1">Structure de l'environnement d'exécution PHP</a></li>
<li><a href="#sec-4-5-2">Montage d'un dossier partagé <code>/vagrant/TP/</code></a></li>
<li><a href="#sec-4-5-3">Mise à jour des squelettes PHP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. FAQ</a>
<ul>
<li><a href="#sec-5-1">5.1. Si je n'ai que VirtualBox, puis-je me passer de l'installation de Vagrant ?</a></li>
<li><a href="#sec-5-2">5.2. Je n'arrive pas à me connecter depuis la console affichée par VirtualBox</a></li>
<li><a href="#sec-5-3">5.3. Comment installer un environnement de bureau sur la VM</a></li>
<li><a href="#sec-5-4">5.4. <span class="todo TODO">TODO</span> Comment installer l'application exerciseur manuellement</a></li>
<li><a href="#sec-5-5">5.5. J'ai un système 32 bits, est-ce que ça marchera pour moi ?</a></li>
<li><a href="#sec-5-6">5.6. <span class="todo TODO">TODO</span> VirtualBox se plaint d'un problème de virtualisation matérielle</a></li>
<li><a href="#sec-5-7">5.7. Je n'ai pas accès à Internet en haut débit</a></li>
<li><a href="#sec-5-8">5.8. <span class="todo TODO">TODO</span> Vagrant ne trouve pas de <i>box</i> <code>oberger/moocbdvm</code></a></li>
<li><a href="#sec-5-9">5.9. Le message de confirmation de mise en place ne s'affiche pas.</a></li>
<li><a href="#sec-5-10">5.10. Le premier lancement signale que la machine est vérouillée</a></li>
<li><a href="#sec-5-11">5.11. Quand j'utilise la commande <code>vagrant up</code>, je vois de nombreuses lignes "default: Warning: Connection timeout. Retrying&#x2026;" ou "default: Warning: Remote connection disconnect. Retrying&#x2026;"</a></li>
<li><a href="#sec-5-12">5.12. Le lancement de la VM affiche un problème de versions des <i>guest additions</i></a></li>
<li><a href="#sec-5-13">5.13. La machine virtuelle est lancée, mais les pages Web sur le port 8080 ne donnent pas les résultats escomptés</a></li>
<li><a href="#sec-5-14">5.14. <code>vagrant ssh</code> échoue, sous Windows</a></li>
<li><a href="#sec-5-15">5.15. Comment me connecter via SSH à la VM vagrant</a></li>
<li><a href="#sec-5-16">5.16. <span class="todo TODO">TODO</span> J'ai écrasé la base de données, que faire</a></li>
<li><a href="#sec-5-17">5.17. Comment mettre à jour ma machine virtuelle</a>
<ul>
<li><a href="#sec-5-17-1"><span class="todo TODO">TODO</span> Mise à jour partielle</a></li>
<li><a href="#sec-5-17-2"><span class="todo TODO">TODO</span> Réinstallation de la machine virtuelle</a></li>
</ul>
</li>
<<<<<<< HEAD
<li><a href="#sec-5-18">5.18. <span class="todo TODO">TODO</span> Si j'ai déjà un autre virtualiseur, puis-je convertir la VM ?</a></li>
=======
<li><a href="#sec-5-2">5.2. J'ai un système 32 bits, est-ce que ça marchera pour moi ?</a></li>
<li><a href="#sec-5-3">5.3. Je n'ai pas accès à Internet en haut débit</a></li>
<li><a href="#sec-5-4">5.4. Le message de confirmation de mise en place ne s'affiche pas.</a></li>
<li><a href="#sec-5-5">5.5. Quand j'utilise la commande <code>vagrant up</code>, je vois de nombreuses lignes "default: Warning: Connection timeout. Retrying&#x2026;" ou "default: Warning: Remote connection disconnect. Retrying&#x2026;"</a></li>
<li><a href="#sec-5-6">5.6. <span class="todo TODO">TODO</span> Si le binding de port ne fonctionne pas, que faire (rerédiger en fonction du message d'erreur réel)</a></li>
<li><a href="#sec-5-7">5.7. <code>vagrant ssh</code> échoue, sous Windows</a></li>
<li><a href="#sec-5-8">5.8. Comment me connecter via SSH à la VM vagrant</a></li>
<li><a href="#sec-5-9">5.9. <span class="todo TODO">TODO</span> J'ai écrasé la base de données, que faire</a></li>
<li><a href="#sec-5-10">5.10. Si j'ai déjà un autre virtualiseur, puis-je convertir la VM ?</a></li>
<li><a href="#sec-5-11">5.11. Je suis sous Windows et je rencontre un problème d'encodage</a></li>
<li><a href="#sec-5-12">5.12. Vagrant indique que la machine est entrée dans un état non autorisé et conseille d'utiliser VirtualBox pour régler le bug.</a></li>
<li><a href="#sec-5-13">5.13. Vagrant indique que la machine est verrouillée.</a></li>
>>>>>>> Add error cases to the manual
</ul>
</li>
<li><a href="#sec-6">6. À propos de la Box Vagrant du MOOC</a>
<ul>
<li><a href="#sec-6-1">6.1. Architecture technique</a></li>
<li><a href="#sec-6-2">6.2. Utilité dans des contextes différents</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Copyright</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> TL/DR;</h2>
<div class="outline-text-2" id="text-1">
<p>
<b>Pour le lecteur pressé, lire : <a href="./TLDR.html">Prise en main rapide de la Box Vagrant du MOOC BD Télécom SudParis</a>.</b>
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Introduction</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Contexte : Travail Personnel dans le MOOC BD</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Nous mettons à votre disposition un environnement de travail pour les
travaux pratiques / travail personnel (TPs) du <b>MOOC Bases de Données Relationnelles</b>
 de <a href="http://mooc.telecom-sudparis.eu/">Télécom SudParis</a>, basé sur une machine virtuelle.
</p>

<p>
Cet environnement n'est pas indispensable pour les premiers exercices
de requêtes SQL en bases de données (semaines 2, 3) : un exerciseur SQL en
Javascript, s'exécutant dans certains navigateur et ne nécessitant
aucune installation, devrait être suffisant pour les premiers TPs.
</p>

<p>
Pour les cours suivants, portant sur des manipulations avancées, et la
programmation Web pour les bases de données, il sera nécessaire de
disposer d'un environnement plus complet, tel que celui basé sur
<a href="http://www.postgresql.org/">PostgreSQL</a>, que nous vous
proposons dans cette machine virtuelle.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Environnement de travail virtualisé</h3>
<div class="outline-text-3" id="text-2-2">
<p>
L'objectif est de faire tourner, sur le poste de l'apprenant (<i>vous</i>), une
<b>machine virtuelle</b> contenant un serveur Linux dans lequel sont installés :
</p>

<ul class="org-ul">
<li>un <b>serveur de base de donnée</b> (SGBDR) <i>PostgreSQL</i> préconfiguré, dans
lequel des bases de données d'exemples du cours ont été chargées.
</li>

<li>un serveur Web (Apache) permettant de fournir des applications Web
locales utiles pour les TPs :

<ul class="org-ul">
<li>un "<b>exerciseur</b>" qui vous guidera dans l'apprentissage des requêtes
SQL sur les bases de données d'exemples;
</li>

<li>un outil professionnel de requêtage et d'administration des bases
de données PostgreSQL : <b>phpPgAdmin</b>.
</li>
</ul>
</li>
</ul>

<p>
L'objectif est que vous soyez autonomes dans l'utilisation de cet
environnement installé en local sur votre ordinateur, y compris <i>sans
accès à internet</i>.
</p>

<p>
L'utilisation de <b>Vagrant</b> et <b>VirtualBox</b> pour faire tourner cet
environnement permet en théorie un même fonctionnement quelque soit
votre système d'exploitation Linux, MacOSX, Windows (à condition qu'il soit relativement
récent). Consultez cependant attentivement la section <a href="#sec-3-1">Prérequis</a>.
</p>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Compétences requises</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Bien que cet environnement soit basé sur une machine virtuelle Linux, aucune
compétence en <i>administration système</i> Unix ne devrait être nécessaire
pour pouvoir l'utiliser: l'interaction se déroulera principalement 
<b>dans l'interface Web</b> de votre navigateur, au moins pour les premiers TPs.
</p>

<p>
Cet environnement basé sur des logiciels libres est redistribuable, et
potentiellement réutilisable dans d'autre contextes, par exemple pour
votre utilisation professionelle, au-delà de ce MOOC (cf. <a href="#sec-6">À propos de la Box Vagrant du MOOC</a>).
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Avertissement</h3>
<div class="outline-text-3" id="text-2-4">
<p>
<i>Nous avons fait de notre mieux pour fournir un environnement fonctionnel, basé sur des logiciels libres, mais vous l'utilisez <b>à vos risques et périls, sans aucune garantie</b>. Nous ne pouvons être tenus responsables des dommages qui résulteraient de l'utilisation de cet environnement.</i>
</p>

<p>
L'ensemble des sources de cet environnement sont disponibles en
logiciel libre sur XXX (sous licences XXX), y compris les outils ayant
permis la construction de la machine virtuelle.
</p>
</div>
</div>

<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Glossaire</h3>
<div class="outline-text-3" id="text-2-5">
<dl class="org-dl">
<dt> box </dt><dd>paquetage d'installation d'une <i>machine virtuelle</i>
préconfigurée, qui est pris en charge par l'application
<i>Vagrant</i>. Les différentes versions des box sont publiées sur
Internet (sur <code>https://vagrantcloud.com/</code>), afin de faciliter
leur mise-à-jour.
</dd>
<dt> exerciseur </dt><dd>application destinée à faciliter l'apprentissage
</dd>
<dt> guest </dt><dd>voir <i>machine virtuelle</i>
</dd>
<dt> hôte </dt><dd>votre machine, avec un système d'exploitation, sur
laquelle est installé le virtualiseur <i>VirtualBox</i> utilisé par
<i>Vagrant</i> (c'est par exemple votre système <i>Windows 7</i> habituel).
</dd>
<dt> machine virtuelle </dt><dd>un système d'exploitation <i>virtualisé</i> (ici un
<i>Linux</i> sur une machine fictive ayant 2.5 Go de disque et 256 Mo de
RAM), qui est donc isolé des autres programmes de votre système
<i>hôte</i>. Nous l'avons préinstallé avec différents
logiciels. VirtualBox et Vagrant font fonctionner cette machine virtuelle:
démarrage, arrêt, mise en pause, etc.
</dd>
<dt> VM </dt><dd><i>Virtual Machine</i> voir <i>machine virtuelle</i>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Installation</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Prérequis</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Disposer d'une machine moderne avec un système d'exploitation 64
bits (ou 32 bits<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>) sur lequel VirtualBox&trade; fonctionne<sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup>
</li>
<li>Avoir un environnement internet à haut débit, le temps de télécharger l'environnement<sup><a id="fnr.3" name="fnr.3" class="footref" href="#fn.3">3</a></sup>
</li>
<li>Avoir au moins 3 Go de libre sur un disque dur local
</li>
<li>Maîtriser un minimum l'utilisation de votre système d'exploitation,
notamment en mode invite de commandes (commandes de base DOS ou shell
Unix, type <code>cd</code>, <code>ls/dir</code>, etc.).
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Télécharger et installer Vagrant et VirtualBox</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Vous aurez besoin d'installer Vagrant et VirtualBox, qui devraient
normalement être disponibles sur les systèmes d'exploitations les plus
populaires (Linux, Windows, Mac OS X). Le mode opératoire devrait donc
être identique pour tous, quelque soit l'OS utilisé.
</p>

<p>
<i>VirtualBox</i> servira à faire fonctionner la virtualisation, alors que
<i>Vagrant</i> se chargera du téléchargement de la dernière version de
l'image de machine, et de la création automatique de la machine
virtuelle, correctement paramétrée.
</p>

<p>
Téléchargez les <b>versions les plus récentes</b> de ces deux applications
depuis leurs sites, et installez-les (nécessite les privilèges
d'administration). Attention à installer une version récente :
certains paquetages officiels de distributions peuvent être obsolètes,
notamment pour Vagrant (voir sur le site de téléchargements du projet
Vagrant les paquetages pour Linux <code>.deb) ou =.rpm</code>).
</p>

<p>
Sites de téléchargement :
</p>
<ul class="org-ul">
<li><b>VirtualBox</b> : <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a>
</li>
<li><b>Vagrant</b> : <a href="http://www.vagrantup.com/downloads.html">http://www.vagrantup.com/downloads.html</a> (peut nécessiter
un redémarrage, sur Windows)
</li>
</ul>

<p>
Vous aurez éventuellement besoin d'installer un <i>client SSH</i> si vous
n'en avez pas encore installé un. Sur Windows, voir l'<a href="#sec-5-14">entrée de FAQ</a> correspondante.
</p>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Initialisation et mise en route</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Choisir un <b>dossier de travail</b> dans lequel Vagrant va installer une
<b>machine virtuelle</b>, et où les fichiers des TPs vont résider. Ce dossier
doit être choisi sur une partition disposant d'au moins 1,5 Go d'espace de
stockage libre.
</p>


<p>
Pour télécharger la <i>box</i> Vagrant et procéder au premier lancement de de la <i>machine virtuelle</i>, suivre les étapes suivantes :
</p>

<ol class="org-ol">
<li>ouvrir un <i>invite de commandes</i> <sup><a id="fnr.4" name="fnr.4" class="footref" href="#fn.4">4</a></sup> dans le dossier de travail
choisi (utiliser la commande <code>cd</code> pour s'y positionner):
</li>
<li>entrer la commande suivante, selon le profil de votre matériel / système : 
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Systèmes <code>64 bits</code></th>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">Systèmes <code>32 bits</code> (ou virtualisation</th>
</tr>

<tr>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">matérielle pas disponible)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left"><code>vagrant init oberger/moocbdvm</code></td>
<td class="left">&#xa0;</td>
<td class="left"><code>vagrant init oberger/moocbdvm32</code></td>
</tr>
</tbody>
</table>
<p>
un fichier <code>Vagrantfile</code> est créé dans le dossier de travail :
</p>
<pre class="example">
A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.
</pre>
</li>
<li>entrer la commande suivante :
<pre class="example">
vagrant up
</pre>
<p>
ceci va télécharger la dernière version de la <a href="https://vagrantcloud.com/oberger/moocbdvm"><i>box</i> <code>oberger/moocbdvm</code></a> depuis Internet
(env. 350 Mo), et démarrer une machine virtuelle VirtualBox
en tâche de fond, qui fournira l'environnement que vous allez utiliser.
</p>
</li>
</ol>

<p>
<b>ATTENTION: La mise en place peut être longue et prendre du temps sur les machines peu puissantes et/ou ne disposant pas d'une connexion internet haut-débit.</b>
</p>

<p>
La mise en place est terminée quand s'affichent les 4 lignes suivantes :
</p>
<pre class="example">
==&gt; default: Machine booted and ready!
==&gt; default: Checking for guest additions in VM...
==&gt; default: Mounting shared folders...
    default: /vagrant =&gt; ...CHEMIN DE VOTRE DOSSIER DE TRAVAIL...
</pre>

<p>
Si tout va bien, la machine virtuelle
est visible dans l'interface d'administration de VirtualBox (et peut
être démarrée, arrêtée, ou mise en pause comme une machine virtuelle
ordinaire).
</p>

<p>
Pour une explication des commandes de base de Vagrant,
consultez
<a href="http://docs.vagrantup.com/v2/getting-started/index.html">le guide de démarrage vagrant (en anglais)</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Utilisation</h2>
<div class="outline-text-2" id="text-4">
<p>
La machine virtuelle doit être lancée, en tâche de fond dans VirtualBox, pour pouvoir
utiliser l'environnement de travail personnel du MOOC. 
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Lancement de la machine virtuelle</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li>ouvrir un invite de commandes dans le dossier de travail;
</li>

<li>entrer la commande:
<pre class="example">
vagrant up
</pre>
<p>
la mise en place de la machine est finie quand s'affiche la ligne "&#x2026;". Si la machine virtuelle était déjà lancée, rien ne se passe, tant mieux.
</p>

<p>
Il se peut qu'un message affiche un avertissement si une nouvelle version de la box a été publiée depuis l'installation :
</p>
<pre class="example">
==&gt; default: A newer version of the box 'oberger/moocbdvm' is available! You currently
==&gt; default: have version '0.1.0'. The latest is version '42.0'. Run
==&gt; default: `vagrant box update` to update.
</pre>
<p>
vous pouvez probablement ignorer ce message. Dans la plupart des cas, il est peu probable qu'une réinstallation de la box soit nécessaire : cf. <a href="#sec-5-17">Comment mettre à jour ma machine virtuelle</a>.
</p>
</li>
</ol>

<p>
Une fois lancée, elle fournit un <b>serveur HTTP</b> qui est redirigé sur
l'adresse locale de l'ordinateur <i>hôte</i> <code>localhost</code> (<code>127.0.0.1</code>), qui
écoute sur le <b>port <code>8080</code></b> (d'où les URLs ci-dessous commençant par <b><code>http://localhost:8080/</code></b>).
</p>
</div>
</div>


<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Exerciseur de requêtes SQL</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Une fois la machine virtuelle lancée, ouvrir un navigateur Web et aller sur <a href="http://localhost:8080/bdsqlwiz/appli/">http://localhost:8080/bdsqlwiz/appli/</a>
</p>

<p>
TODO screenshot
</p>

<p>
Vous pouvez maintenant commencer votre apprentissage du langage SQL,
en sélectionnant l'une des deux bases de données disponibles (<i>films</i>
ou <i>vins), puis en construisant des requêtes SQL à l'aide des outils
présents dans les différentes /frames</i>.
</p>

<p>
Vos requêtes seront transmises au serveur PostgreSQL qui tourne en
tâche de fond dans la VM, pour être exécutées.
</p>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Module Web d'administration PostgreSQL <i>phpPgAdmin</i></h3>
<div class="outline-text-3" id="text-4-3">
<p>
Le serveur Web intégré dans la VM met aussi à votre disposition
l'environnement d'administration <b>phpPgAdmin</b>. Cet environnement est
très complet et fournit notamment des outils permettant la
manipulation du <i>schéma des bases de données</i> et l'administration du
SGBD.
</p>

<ul class="org-ul">
<li>Connectez votre navigateur à l'adresse :
<a href="http://localhost:8080/phppgadmin/">http://localhost:8080/phppgadmin/</a>
</li>
</ul>
</div>

<div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1">Requêtage</h4>
<div class="outline-text-4" id="text-4-3-1">
<ul class="org-ul">
<li>Connectez-vous au <i>Serveur</i> <code>PostgreSQL</code> :

<ul class="org-ul">
<li>User : <code>pg_reader</code>
</li>

<li>Password : <code>tpinfint</code>
</li>
</ul>
</li>
</ul>

<p>
Vous pouvez désormais saisir des requêtes SQL (de consultation seulement) sur le serveur PostgreSQL.
</p>
</div>
</div>


<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2">Mises à jour</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
Connectez-vous avec utilisateur <code>pg_writer</code> au lieu de <code>pg_reader</code>
(même mot-de-passe).
</p>
</div>
</div>


<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3">Administration</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
Connectez-vous en tant qu'utilisateur <i>administrateur</i> du SGBD (login:
<code>postgres</code>, mot de passe : <code>postgres</code>).
</p>

<p>
Bien entendu, tout est possible quand on est administrateur, donc
attention avant de tout casser.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> En ligne de commande PostgreSQL</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Pour exécuter des commandes SQL sur le serveur PostgreSQL présent à l'interieur de la machine virtuelle, procéder comme suit :
</p>

<ol class="org-ol">
<li>connectez-vous dans la machine virtuelle dans le compte <code>vagrant</code>
<pre class="example">
vagrant ssh
</pre>
<p>
vous devriez alors voir le <i>prompt</i> du shell Linux (si un client SSH est disponible &#x00ad;&#x2013; Cf. <a href="#sec-5-14">FAQ</a>), quelque chose du style :
</p>
<pre class="example">
Linux localhost 3.14-2-amd64 #1 SMP Debian 3.14.13-2 (2014-07-24) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Aug 13 13:27:54 2014 from 10.0.2.2
vagrant@localhost:~$
</pre>
</li>

<li>lancez la commande de connexion à PostgreSQL en ligne de commande (connexion à la base <code>vins</code> en tant qu'utilisateur PostgreSQL <code>pg_reader</code> :
<pre class="example">
psql -U pg_reader vins
</pre>
<p>
vous devriez alors voir le <i>prompt</i> de l'interface ligne de commandes de PostgreSQL.
</p>
<pre class="example">
psql (9.4beta2)
Saisissez « help » pour l'aide.

vins=&gt;
</pre>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> Programmation Web / BD en PHP</h3>
<div class="outline-text-3" id="text-4-5">
</div><div id="outline-container-sec-4-5-1" class="outline-4">
<h4 id="sec-4-5-1">Structure de l'environnement d'exécution PHP</h4>
<div class="outline-text-4" id="text-4-5-1">
<p>
Les exercices de programmation de pages Web en PHP nécessitent un
serveur Web et l'interpréteur PHP. La VM contient un tel environnement
(Apache + mod<sub>php</sub>).
</p>

<p>
Pour tester vos programmes, il faudra donc placer des fichier <code>.php</code>
dans un répertoire accessible par le serveur Web Apache.
</p>

<p>
Nous avons configuré le serveur Apache de la VM de façon à ce qu'il
puisse exécuter des scripts PHP présents dans le répertoire
<code>/vagrant/TP/</code> de la VM, le résultat devenant accessible sur
<a href="http://localhost:8080/TP/">http://localhost:8080/TP/</a>.
</p>
</div>
</div>

<div id="outline-container-sec-4-5-2" class="outline-4">
<h4 id="sec-4-5-2">Montage d'un dossier partagé <code>/vagrant/TP/</code></h4>
<div class="outline-text-4" id="text-4-5-2">
<p>
La box Vagrant est configurée de façon à ce que ce répertoire de tests
PHP corresponde au sous-répertoire "<code>TP/</code>" qui a normalement été créé
dans le dossier de travail lorsque vous avez lancé la création de la
machine virtuelle (<code>vagrant up</code> initial).
</p>

<p>
Tout le contenu du dossier de travail de l'hôte est en effet <i>monté</i>
en tant que <code>/vagrant/</code> dans la VM, comme <i>dossier partagé</i>
VirtualBox.
</p>

<p>
Par exemple, sur Windows le contenu de <code>C:\Users\olivier\vagrant\</code> serait directement
monté en tant que <code>/vagrant/</code>.
</p>

<p>
L'avantage d'un tel montage est de permettre l'édition des fichiers
<b>depuis l'hôte</b>, avec l'éditeur de texte ou l'<i>IDE</i> préféré dans
l'environnement de bureau natif de votre système habituel, tout en
permettant les tests <b>en direct à l'intérieur de la VM</b>, sans besoin de
recopie entre les deux systèmes.
</p>
</div>
</div>

<div id="outline-container-sec-4-5-3" class="outline-4">
<h4 id="sec-4-5-3">Mise à jour des squelettes PHP</h4>
<div class="outline-text-4" id="text-4-5-3">
<p>
Le sous-répertoire <code>TP/</code> devrait normalement contenir un ensemble de
squelettes de départ servant de base pour les TPs, image du contenu
mis en ligne par les enseignants. Vous pourrez faire un <code>git pull</code>
dans ce répertoire pour récupérer des mises-à-jour. Si vous n'avez pas
installé Git sur votre système hôte, vous pourrez toutefois l'utiliser depuis
l'intérieur de la VM (via une connexion SSH, en travaillant dans
<code>/vagrant/TP/</code>).
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> FAQ</h2>
<div class="outline-text-2" id="text-5">
<p>
<a id="FAQ" name="FAQ"></a>
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Si je n'ai que VirtualBox, puis-je me passer de l'installation de Vagrant ?</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Il est possible de télécharger une <i>box</i> Vagrant (fichier <code>.box</code>) et
d'en extraire le contenu (c'est en réalité une archive <i>tar</i>
compressée, équivalente à un <code>.tgz</code> / <code>.tar.gz</code>).
</p>

<p>
Pour télécharger le fichier, <code>.box</code>, consultez
<a href="https://vagrantcloud.com/oberger/moocbdvm/versions">https://vagrantcloud.com/oberger/moocbdvm/versions</a> et récupérez l'URL
du fichier <code>.box</code> de la dernière version.
</p>
<pre class="example">
$ wget https://vagrantcloud.com/oberger/moocbdvm/version/.../provider/virtualbox.box
</pre>

<p>
Pour extraire le contenu, utilisez par exemple <code>tar</code>, sous
Unix : <code>tar zxf virtualbox.box</code>.
</p>

<pre class="example">
$ tar ztf virtualbox.box
./Vagrantfile
./box.ovf
./include/
./include/_Vagrantfile
./box-disk1.vmdk
</pre>

<p>
On peut en extraire un fichier de définition de machine virtuelle
VirtualBox (<code>./box.ovf</code>), ainsi que le fichier d'image de disque
(<code>./box-disk1.vmdk</code>) correspondant.
</p>

<p>
Il est alors possible d'<b>importer</b> le fichier <code>.ovf</code> dans VirtualBox, et de
redéfinir les redirections de ports appropriées, ou les partages de
dossiers (<code>/vagrant/</code>), etc.
</p>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Je n'arrive pas à me connecter depuis la console affichée par VirtualBox</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Attention : le clavier configuré par défaut, pour la console de login
affichée par VirtualBox est en disposition <b>azerty</b> (comme rappelé par
le message d'accueil affiché avant le prompt de <i>login</i>).
</p>

<p>
Une alternative à l'utilisation de la console affichée par VirtualBox,
est d'utiliser <code>vagrant ssh</code>, qui fonctionnera en principe quelque
soit votre disposition de clavier.
</p>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Comment installer un environnement de bureau sur la VM</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Normalement, vous n'aurez pas besoin d'utiliser la machine virtuelle en mode bureau graphique pour les TPs du MOOC, mais c'est cependant tout-à-fait faisable.
</p>

<p>
Nous fournissons un script de mise-à-jour permettant d'installer (en
mode superutilisateur Linux) l'environnement de bureau XFCE4,
préconfiguré en français avec clavier azerty : <code>/usr/local/sbin/install-gui.sh</code>.
</p>

<p>
Pour le lancer, rentrer la commande suivante :
</p>
<pre class="example">
vagrant ssh -c "sudo /usr/local/sbin/install-gui.sh"
</pre>

<p>
Attention, ceci fait augmenter substentiellement l'occupation disque de la machine virtuelle.
</p>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> <span class="todo TODO">TODO</span> Comment installer l'application exerciseur manuellement</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Les sources sont disponibles depuis git avec : 
git clone <a href="http://fusionforge.int-evry.fr/anonscm/git/bdsqlwiz/bdsqlwiz.git">http://fusionforge.int-evry.fr/anonscm/git/bdsqlwiz/bdsqlwiz.git</a>
</p>

<p>
TBD : archive extractible .zip, dans
<a href="https://fusionforge.int-evry.fr/frs/?group_id=64">https://fusionforge.int-evry.fr/frs/?group_id=64</a>
</p>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> J'ai un système 32 bits, est-ce que ça marchera pour moi ?</h3>
<div class="outline-text-3" id="text-5-5">
<p>
La version canonique sur laquelle nous avons basé nos réalisations et
nos tests de VM est la version 64 bits (architecture Linux <code>amd64</code>), qui
nécessite un hôte 64 bits.
</p>

<p>
Nous mettons également à votre disposition une version 32 bits, mais ayant fait
l'objet de tests moins poussés.
</p>

<p>
Pour l'utiliser, remplacer
<code>oberger/moocbdvm</code> par <b><code>oberger/moocbdvm32</code></b> dans les instructions
<code>vagrant init</code> :
</p>

<pre class="example">
vagrant init oberger/moocbdvm32
</pre>
</div>
</div>


<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> <span class="todo TODO">TODO</span> VirtualBox se plaint d'un problème de virtualisation matérielle</h3>
<div class="outline-text-3" id="text-5-6">
<p>
Il se peut que vous voyiez un des messages suivants dans VirtualBox :
</p>
<pre class="example">
"La virtualisation matérielle VT-x/AMD-V n'est pas disponible sur votre système. L'invité 64 bits ne détectera pas un processeur 64 bits et ne pourra pas démarrer."
</pre>
<p>
ou
</p>
<pre class="example">
La virtualisation matérielle VT-x/AMD-V a été sélectionnée, mais n'est 
pas active. L'invité 64 bits ne détectera pas un processeur 64 bits et 
ne pourra probablement pas démarrer.

Assurez-vous que vous avez bien activé le VT-x/AMD-V dans le BIOS de 
votre ordinateur hôte.
</pre>
<p>
et le message suivant affiché dans l'invite de commandes par Vagrant :
</p>
<pre class="example">
The guest machine entered an invalid state while waiting for it
to boot. Valid states are 'starting, running'. The machine is in the
'paused' state. Please verify everything is configured
properly and try again.

If the provider you're using has a GUI that comes with it,
it is often helpful to open that and watch the machine, since the
GUI often has more helpful error messages than Vagrant can retrieve.
For example, if you're using VirtualBox, run `vagrant up` while the
VirtualBox GUI is open.
</pre>

<p>
Ceci signifie en général que vous avez essayé de lancer une VM pour la
box 64 bits alors que votre système est en 32 bits, ou que votre
processeur ne dispose pas des fonctionnalités suffisantes.
</p>

<p>
Réessayez avec la box <b>32 bits</b> : <code>oberger/moocbdvm32</code> (cf. 
<a href="#sec-5-5">J'ai un système 32 bits, est-ce que ça marchera pour moi ?</a>).
</p>
</div>
</div>

<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> Je n'ai pas accès à Internet en haut débit</h3>
<div class="outline-text-3" id="text-5-7">
<p>
C'est bien dommage (d'autant que visionner les vidéos du MOOC doit
être pénible, dans ce cas). Cependant, vous pouvez installer de façon
indépendantes, les applications que nous avons empaquetées dans la
<i>box</i>.
</p>

<p>
Notez tout d'abord qu'un environnement d'exerciseur est disponible
aussi pour les navigateurs basés sur Webkit (Chrome, Safari), sans
nécessiter l'installation d'un SGBD comme PostgreSQL. (Cf. XXX - TODO)
</p>

<p>
Autrement, pas besoin de machine virtuelle, si vous savez installer un
SGBD par vous-même. Si vous avez la possibilité de créer une base de
données PostgreSQL localement, les scripts de création de base sont
disponibles dans XXX TODO.
</p>
</div>
</div>

<div id="outline-container-sec-5-8" class="outline-3">
<h3 id="sec-5-8"><span class="section-number-3">5.8</span> <span class="todo TODO">TODO</span> Vagrant ne trouve pas de <i>box</i> <code>oberger/moocbdvm</code></h3>
<div class="outline-text-3" id="text-5-8">
<p>
La commande <code>vagrant up</code> renvoit un message du style :
</p>
<pre class="example">
There was a problem with the configuration of Vagrant. The error message(s)
are printed below:

vm:
  The box 'oberger/moocbdvm' could not be found.
</pre>
<p>
ou bien un message du type :
</p>
<pre class="example">
[vagrant] Downloading with Vagrant::Downloaders::File...
[vagrant] Copying box to temporary location...
[vagrant] Extracting box...
[vagrant] Cleaning up downloaded box...
Failed to untar the box file. This is usually because you're
attempting to add a box that isn't a valid box file. Please
double check that the box file is properly packaged.
</pre>

<p>
Vous utilisez probablement une version trop ancienne de Vagrant, alors que nous recommandons une version &gt;= 1.6.3
(vérifiez avec <code>vagrant --version</code>).
</p>
</div>
</div>

<div id="outline-container-sec-5-9" class="outline-3">
<h3 id="sec-5-9"><span class="section-number-3">5.9</span> Le message de confirmation de mise en place ne s'affiche pas.</h3>
<div class="outline-text-3" id="text-5-9">
<p>
Reprendre les instuctions d'installation depuis le début en vérifiant que toutes les étapes ont été correctement suivies.
</p>

<p>
Il peut être nécessaire de mettre à jour la box (commandes <code>vagrant box outdated</code>, etc.). Veuillez vous reporter <a href="#sec-5-17-2">Réinstallation de la machine virtuelle</a>.
</p>

<p>
Si le problème persiste, contactez-nous via les forums du MOOC.
</p>
</div>
</div>

<div id="outline-container-sec-5-10" class="outline-3">
<h3 id="sec-5-10"><span class="section-number-3">5.10</span> Le premier lancement signale que la machine est vérouillée</h3>
<div class="outline-text-3" id="text-5-10">
<p>
Au premier <code>vagrant up</code>, il se peut que Vagrant affiche un message d'erreur du style :
</p>
<pre class="example">
Vagrant can't use the requested machine because it is locked! This
means that another Vagrant process is currently reading or modifying
the machine. Please wait for that Vagrant process to end and try
again. Details about the machine are shown below:
Name: default
Provider: virtualbox
</pre>

<p>
Il semble que cela ne soit pas rédhibitoire : un nouveau <code>vagrant up</code> semble pouvoir régler le problème.
</p>
</div>
</div>

<div id="outline-container-sec-5-11" class="outline-3">
<h3 id="sec-5-11"><span class="section-number-3">5.11</span> Quand j'utilise la commande <code>vagrant up</code>, je vois de nombreuses lignes "default: Warning: Connection timeout. Retrying&#x2026;" ou "default: Warning: Remote connection disconnect. Retrying&#x2026;"</h3>
<div class="outline-text-3" id="text-5-11">
<p>
Tout d'abord, ces lignes sont tout à fait normales si leur nombre est peu élevé et correspondent au temps de démarrage de la machine.
</p>

<p>
Si l'invite de commandes en est rempli, il est conseillé d'interrompre
la commande (ctrl-C sur UNIX, XXX sur windows) et de recommencer
l'étape d'installation que vous faisiez.
</p>
</div>
</div>

<div id="outline-container-sec-5-12" class="outline-3">
<h3 id="sec-5-12"><span class="section-number-3">5.12</span> Le lancement de la VM affiche un problème de versions des <i>guest additions</i></h3>
<div class="outline-text-3" id="text-5-12">
<p>
Il se peut qu'au démarrage de la VM, un message soit affiché, du style :
</p>
<pre class="example">
Checking for guest additions in VM...
The guest additions on this VM do not match the installed version of
VirtualBox! In most cases this is fine, but in rare cases it can
prevent things such as shared folders from working properly. If you see
shared folder errors, please make sure the guest additions within the
virtual machine match the version of VirtualBox you have installed on
your host and reload your VM.

Guest Additions Version: 4.3.14
VirtualBox Version: 4.1
</pre>

<p>
A priori, ce n'est pas gênant pour le bon fonctionnement de la VM.
</p>
</div>
</div>

<div id="outline-container-sec-5-13" class="outline-3">
<h3 id="sec-5-13"><span class="section-number-3">5.13</span> La machine virtuelle est lancée, mais les pages Web sur le port 8080 ne donnent pas les résultats escomptés</h3>
<div class="outline-text-3" id="text-5-13">
<p>
Normalement, au démarrage de la machine virtuelle, Vagrant configure
une redirection (<i>forward</i>) du port <code>80</code> (HTTP) du <i>guest</i>, vers le
port <code>8080</code> de l'<i>hôte</i>, et respectivement, du port <code>22</code> (SSH) vers le
port <code>2222</code>. Il se peut qu'une telle redirection soit impossible (par
exemple si une autre application de l'hôte utilise déjà le port
<code>8080</code>, ou si une autre machine virtuelle a déjà été lancée avec une
telle redirection).
</p>

<p>
Dans ce cas, il est probable qu'un autre port aura été utilisé pour la
redirection, que <code>8080</code>.
</p>

<p>
Dans un tel cas, <code>vagrant up</code> affiche des messages su style :
</p>
<pre class="example">
==&gt; default: Fixed port collision for 80 =&gt; 8080. Now on port 2200.
==&gt; default: Fixed port collision for 22 =&gt; 2222. Now on port 2201.
...
==&gt; default: Forwarding ports...
    default: 80 =&gt; 2200 (adapter 1)
    default: 22 =&gt; 2201 (adapter 1)
</pre>

<p>
On voit ici que le port <code>2200</code> a été utilisé au lieu de <code>8080</code>. Il
faudrait alors adapter toutes les URLs de ce document, pour utiliser à
la place <code>http://localhost:2200</code>. De façon similaire, il faudrait
configurer le client SSH pour se connecter au port <code>2201</code> (<code>ssh -p 2201 vagrant@localhost</code>).
</p>
</div>
</div>

<div id="outline-container-sec-5-14" class="outline-3">
<h3 id="sec-5-14"><span class="section-number-3">5.14</span> <code>vagrant ssh</code> échoue, sous Windows</h3>
<div class="outline-text-3" id="text-5-14">
<p>
Si vous n'avez pas installé un client SSH, ou si vous n'avez pas
configuré sa disponibilité dans le PATH, il y a de fortes chances que
vous voyiez un message du genre :
</p>
<pre class="example">
`ssh` executable not found in any directories in the %PATH% variable. Is an
 SSH client installed? Try installing Cygwin, MinGW or Git, all of which
 contain an SSH client. Or use your favorite SSH client with the following
 authentication information shown below:
 Host: 127.0.0.1
 Port: 2222
 Username: vagrant
 Private key: C:/Users/olivier/.vagrant.d/insecure_private_key
</pre>

<p>
En effet, comme l'indique ce message, en plus de l'installation de Vagrant et VirtualBox, il est nécessaire
d'installer un client SSH que Vagrant pourra utiliser pour se
connecter (avec une clé privée particulière) de façon transparente à
l'intérieur du <i>guest</i>.
</p>

<p>
Sur les systèmes Windows, il est probable qu'aucun client SSH ne sera
installé par défaut.
</p>

<p>
Ceci est une FAQ Vagrant, pour laquelle de nombreuses ressources
Internet sont disponibles. 
</p>

<p>
Parmi les solutions possibles, nous avons préféré l'installation de
<a href="http://git-scm.com/download/win">Git pour windows</a>. À
l'installation, dans le dialogue de configuration "<i>Adjusting your
PATH environment</i>", choisissez l'option "<i>Use Git from Bash only</i>". Il
suffira alors de lancer les commandes Vagrant (comme <code>vagrant ssh</code>)
depuis <i>Git Bash</i> plutôt que depuis l'invite de commandes standard de
Windows.
</p>

<p>
Contactez les forums du MOOC si vous n'y arrivez pas par vous-même.
</p>
</div>
</div>

<div id="outline-container-sec-5-15" class="outline-3">
<h3 id="sec-5-15"><span class="section-number-3">5.15</span> Comment me connecter via SSH à la VM vagrant</h3>
<div class="outline-text-3" id="text-5-15">
<p>
Normalement, la commande <code>vagrant ssh</code> permet de faire cela de façon
transparente.
</p>

<p>
Sinon, n'importe quel client SSH fera l'affaire : se connecter avec
l'utilisateur <code>vagrant</code> et le mot-de-passe <code>vagrant</code> sur le port 2222
de l'<i>hôte</i> (redirigé vers le port 22 du <i>guest</i>) : <code>ssh -p 2222 vagrant@localhost</code> (mot de passe : <code>vagrant</code>)
</p>
</div>
</div>


<div id="outline-container-sec-5-16" class="outline-3">
<h3 id="sec-5-16"><span class="section-number-3">5.16</span> <span class="todo TODO">TODO</span> J'ai écrasé la base de données, que faire</h3>
</div>

<div id="outline-container-sec-5-17" class="outline-3">
<h3 id="sec-5-17"><span class="section-number-3">5.17</span> Comment mettre à jour ma machine virtuelle</h3>
<div class="outline-text-3" id="text-5-17">
<p>
Dans la plupart des cas, il n'est pas nécessaire de réinstaller la VM à partir d'une nouvelle version de la box : une mise à jour partielle sera suffisante.
</p>
</div>

<div id="outline-container-sec-5-17-1" class="outline-4">
<h4 id="sec-5-17-1"><span class="todo TODO">TODO</span> Mise à jour partielle</h4>
<div class="outline-text-4" id="text-5-17-1">
<p>
Il est possible de metre à jour via internet une partie des scripts et
applications installés sur la machine
</p>

<ul class="org-ul">
<li>apt-get dist-upgrade ??
</li>
<li>maj-maj
</li>
<li>&#x2026;
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-17-2" class="outline-4">
<h4 id="sec-5-17-2"><span class="todo TODO">TODO</span> Réinstallation de la machine virtuelle</h4>
<div class="outline-text-4" id="text-5-17-2">
<p>
Pour réinstaller une machine virtuelle complète :
</p>
<ul class="org-ul">
<li><code>vagrant destroy</code> dans le dossier de travail
</li>
<li><code>suppression du dossier de travail</code>
</li>
<li><code>vagrant init oberger/moocbdvm</code>
</li>
<li><code>vagrant box outdated</code> 

<p>
Vérifie sur <code>vagrantcloud.com</code> si une mise-à-jour de la box Vagrant
a été publiée :
</p>
<pre class="example">
Checking if box 'oberger/moocbdvm' is up to date...
A newer version of the box 'oberger/moocbdvm' is available! You currently
have version '0.1.0'. The latest is version '42.0'. Run
`vagrant box update` to update.
</pre>
</li>
<li><code>vagrant box update</code>, si nécessaire <i>(si une mise-à-jour disponible doit effectivement être installée)</i>
</li>
<li><code>vagrant up</code>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5-18" class="outline-3">
<h3 id="sec-5-18"><span class="section-number-3">5.18</span> <span class="todo TODO">TODO</span> Si j'ai déjà un autre virtualiseur, puis-je convertir la VM ?</h3>
</div>

<div id="outline-container-sec-5-11" class="outline-3">
<h3 id="sec-5-11"><span class="section-number-3">5.11</span> Je suis sous Windows et je rencontre un problème d'encodage</h3>
<div class="outline-text-3" id="text-5-11">
<p>
Si vous rencontrez un message du type
</p>
<pre class="example">
Chemin/Vers/Vagrant/embedded/gems/gems/childprocess-0.3.9/lib/childprocess/wind
ows/process_builder.rb:63:in `join': incompatible character encodings: CP850 and
 Windows-1252 (Encoding::CompatibilityError)
</pre>

<ul class="org-ul">
<li>Ouvrir une invit de commande et entrer la commande <code>SET VAGRANT_HOME=X:/Chemin/De/Votre/Choix</code> où X correspond au disque de votre choix (C ou D par exemple).
</li>
</ul>
<p>
<b>ATTENTION: Il est nécessaire de refaire cette manipulation après chaque démarrage de la machine si vous souhaitez utiliser vagrant</b>
</p>

<ul class="org-ul">
<li>Ouvrir le fichier X:\Chemin\Vers\Vagrant\embedded\gems\gems\vagrant-1.6.3\bin\vagrant avec un éditeur de texte. Le bloc-note est déconseillé car il rend l'édition difficile.
</li>
</ul>

<p>
-Une fois le fichier ouvert, rajouter ces deux lignes après la première ligne du fichier:
</p>
<pre class="example">
Encoding.default_external = Encoding.find('Windows-1252')
Encoding.default_internal = Encoding.find('Windows-1252')
</pre>

<ul class="org-ul">
<li>Enregistrer le fichier, c'est bon, vous pouvez reprendre votre utilisation de vagrant.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-12" class="outline-3">
<h3 id="sec-5-12"><span class="section-number-3">5.12</span> Vagrant indique que la machine est entrée dans un état non autorisé et conseille d'utiliser VirtualBox pour régler le bug.</h3>
<div class="outline-text-3" id="text-5-12">
<ul class="org-ul">
<li>Si jamais VirtualBox n'a pas été démarré automatiquement, démarrer le et lancer la machine virtuelle.
</li>

<li>Au démarrage de la machine virtuelle, VirtualBox présente un fenêtre d'erreur avec le texte:
</li>
</ul>
<pre class="example">
La virtualisation matérielle VT-x/AMD-V a été sélectionnée, mais n'est pas active. L'invité 64 bits ne détectera pas un processeur 64 bits et ne pourra probablement pas démarrer.
Assurez-vous que vous avez bien activé le VT-x/AMD-V dans le BIOS de votre ordinateur hôte.
</pre>

<p>
<b>Si vous êtes un utilisateur novice et/ou que vous ne voulez pas vous compliquer la vie</b>
</p>

<ul class="org-ul">
<li>Utiliser la version 32 bits de la machine virtuelle, disponible grâce à <code>vagrant init oberger/moocbdvm32</code>.
</li>
</ul>

<p>
<b>Si vous êtes un utilisateur expérimenté</b>
</p>

<ul class="org-ul">
<li>Vérifier que votre processeur supporte la virtualisation d'OS 64bits (site du frabricant etc.)
</li>

<li>S'il le supporte, aller dans le bios et vérifier que l'option de virtualisation est bien cochée.
</li>

<li>Sinon, utiliser la version 32 bits de la machine virtuelle, utilisable grâce à =vagrant init oberger/moocbdvm32.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-13" class="outline-3">
<h3 id="sec-5-13"><span class="section-number-3">5.13</span> Vagrant indique que la machine est verrouillée.</h3>
<div class="outline-text-3" id="text-5-13">
<ul class="org-ul">
<li>Il suffit juste de refaire un <code>vagrant up</code>.
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> À propos de la Box Vagrant du MOOC</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Architecture technique</h3>
<div class="outline-text-3" id="text-6-1">
<p>
La machine virtuelle déployée par la <i>box</i> Vagrant est basée sur un
système GNU/Linux (<a href="http://www.debian.org/">Debian</a> <i>jessie</i>).
</p>

<p>
Nous avons essayé de le rendre aussi léger que possible, mais portable
sur tout système cible récent dans lequel le gestionnaire de
machines virtuelles VirtualBox est disponible (couple Vagrant et VirtualBox).
</p>

<p>
La fabrication de la box Vagrant repose sur l'utilisation de
<a href="http://andsens.github.io/bootstrap-vz/">bootstrap-vz</a> pour l'installation du système Debian de base, complétée
par des scripts de <i>provisionning</i> que nous avons développés
(disponibles sur &#x2026;)
</p>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Utilité dans des contextes différents</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Bien que les exemples du cours soit relativement simples, nous avons
essayé de nous baser, pour cet environnement, sur une solution
réaliste utilisée dans le monde professionnel (Debian, PostreSQL,
phpPgAdmin, etc.).
</p>

<p>
Si la solution de virtualisation choisie ne convient pas à vos
contraintes, mais que vous avez installé un autre environnement
PostgreSQL + Apache/PHP, il est toujours possible d'installer
manuellement l'application d'exerciseur que nous avons développée,
mais nous ne pouvons nous engager à fournir un support sur celle-ci.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Copyright</h2>
<div class="outline-text-2" id="text-7">
<p>
<i>This document is (C) Copyright 2014 by Stephane Germain and Institut Mines-Telecom and is licensed under a</i> <a href="http://creativecommons.org/licenses/by-sa/4.0/"><i>Creative Commons Attribution-ShareAlike 4.0 International License</i></a>.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Notes de bas de page: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
Si votre système n'est pas 64 bits, attention, certaines
commandes devront être modifiées pour télécharger la bonne version de
la box Vagrant. Cf . <a href="#sec-5-5">J'ai un système 32 bits, est-ce que ça marchera pour moi ?</a>.
</p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p class="footpara">
Nous avons réalisé nos tests sur des ordinateurs portables
professionnels en systèmes GNU/Linux ou Microsoft Windows 7
professional.
</p></div>

<div class="footdef"><sup><a id="fn.3" name="fn.3" class="footnum" href="#fnr.3">3</a></sup> <p class="footpara">
Une fois l'installation de la box réalisée, l'utilisation de la machine virtuelle se fait en local, sans avoir besoin d'une connexion internet.
</p></div>

<div class="footdef"><sup><a id="fn.4" name="fn.4" class="footnum" href="#fnr.4">4</a></sup> <p class="footpara">
autrement appelé <i>terminal</i>, <i>shell</i>, selon les systèmes
d'exploitation. Sur Windows, on peut aussi utiliser l'outil <i>Windows Powershell</i>, ou
<i>Git bash</i>, si ce dernier a été installé.
</p></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Auteur: Stéphane Germain, Olivier Berger</p>
<<<<<<< HEAD
<p class="date">Date: 2014-08-20 mer. 16:08</p>
=======
<p class="date">Date: 2014-08-21 jeu. 10:58</p>
>>>>>>> Add error cases to the manual
<p class="creator">Copyright (C) 2014, The authors and Institut Mines-Télécom</p>
</div>
</body>
</html>
