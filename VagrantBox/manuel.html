<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
<title>Manuel de la Box Vagrant du MOOC BD</title>
<!-- 2014-08-14 jeu. 10:18 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Stéphane Germain, Olivier Berger" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Manuel de la Box Vagrant du MOOC BD</h1>
<div id="table-of-contents">
<h2>Table des matières</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. TL/DR;</a></li>
<li><a href="#sec-2">2. Introduction</a>
<ul>
<li><a href="#sec-2-1">2.1. Environnement de travail virtualisé</a></li>
<li><a href="#sec-2-2">2.2. Compétences requises</a></li>
<li><a href="#sec-2-3">2.3. Avertissement</a></li>
<li><a href="#sec-2-4">2.4. Glossaire</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Installation</a>
<ul>
<li><a href="#sec-3-1">3.1. Prérequis</a></li>
<li><a href="#sec-3-2">3.2. Télécharger et installer Vagrant et VirtualBox</a></li>
<li><a href="#sec-3-3">3.3. Initialisation et mise en route</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Utilisation</a>
<ul>
<li><a href="#sec-4-1">4.1. Lancement de la machine virtuelle</a></li>
<li><a href="#sec-4-2">4.2. Accès aux applications pour les TPs</a>
<ul>
<li><a href="#sec-4-2-1">Exerciseur de requêtes SQL</a></li>
<li><a href="#sec-4-2-2">Module Web d'administration PostgreSQL <i>phpPgAdmin</i></a></li>
<li><a href="#sec-4-2-3">En ligne de commande PostgreSQL</a></li>
<li><a href="#sec-4-2-4">Faire des mises à jour dans la base de données</a></li>
<li><a href="#sec-4-2-5"><span class="todo TODO">TODO</span> Programmation Web / BD en PHP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-5">5. FAQ</a>
<ul>
<li><a href="#sec-5-1">5.1. <span class="todo TODO">TODO</span> Si je n'ai que VirtualBox, puis-je me passer de l'installation de Vagrant ?</a>
<ul>
<li><a href="#sec-5-1-1">Je n'arrive pas à me connecter depuis la console affichée par VirtualBox</a></li>
<li><a href="#sec-5-1-2">Comment installer un environnement de bureau sur la VM</a></li>
<li><a href="#sec-5-1-3"><span class="todo TODO">TODO</span> Comment installer l'application exerciseur manuellement</a></li>
</ul>
</li>
<li><a href="#sec-5-2">5.2. J'ai un système 32 bits, est-ce que ça marchera pour moi ?</a></li>
<li><a href="#sec-5-3">5.3. Je n'ai pas accès à Internet en haut débit</a></li>
<li><a href="#sec-5-4">5.4. Le message de confirmation de mise en place ne s'affiche pas.</a></li>
<li><a href="#sec-5-5">5.5. Quand j'utilise la commande <code>vagrant up</code>, je vois de nombreuses lignes "default: Warning: Connection timeout. Retrying&#x2026;" ou "default: Warning: Remote connection disconnect. Retrying&#x2026;"</a></li>
<li><a href="#sec-5-6">5.6. <span class="todo TODO">TODO</span> Si le binding de port ne fonctionne pas, que faire (rerédiger en fonction du message d'erreur réel)</a></li>
<li><a href="#sec-5-7">5.7. <code>vagrant ssh</code> échoue, sous Windows</a></li>
<li><a href="#sec-5-8">5.8. Comment me connecter via SSH à la VM vagrant</a></li>
<li><a href="#sec-5-9">5.9. <span class="todo TODO">TODO</span> J'ai écrasé la base de données, que faire</a></li>
<li><a href="#sec-5-10">5.10. Si j'ai déjà un autre virtualiseur, puis-je convertir la VM ?</a></li>
</ul>
</li>
<li><a href="#sec-6">6. À propos de la Box Vagrant du MOOC</a>
<ul>
<li><a href="#sec-6-1">6.1. Architecture technique</a></li>
<li><a href="#sec-6-2">6.2. Utilité dans des contextes différents</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Copyright</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> TL/DR;</h2>
<div class="outline-text-2" id="text-1">
<p>
<b>Pour le lecteur pressé, lire : <a href="./TLDR.html">Prise en main rapide de la Box Vagrant du MOOC BD Télécom SudParis</a>.</b>
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Introduction</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Environnement de travail virtualisé</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Nous mettons à votre disposition un environnement de travail pour les
travaux pratiques / travail personnel (TPs) du MOOC Bases de Données
Relationnelles, basé sur une machine virtuelle.
</p>

<p>
L'objectif est de faire tourner, sur le poste de l'apprenant (<i>vous</i>), une
machine virtuelle contenant un serveur Linux dans lequel sont installés :
</p>

<ul class="org-ul">
<li>un <b>serveur de base de donnée</b> (SGBDR) <i>PostgreSQL</i> préconfiguré, dans
lequel des bases de données d'exemples du cours ont été chargées.
</li>

<li>un serveur Web (Apache) permettant de fournir des applications Web
locales utiles pour les TPs :

<ul class="org-ul">
<li>un "<b>exerciseur</b>" qui vous guidera dans l'apprentissage des requêtes
SQL sur les bases de données d'exemples;
</li>

<li>un outil professionnel de requêtage et d'administration des bases
de données PostgreSQL : <b>phpPgAdmin</b>.
</li>
</ul>
</li>
</ul>

<p>
L'objectif est que vous soyez autonomes dans l'utilisation de cet
environnement installé en local sur votre ordinateur, y compris <i>sans
accès à internet</i>.
</p>

<p>
L'utilisation de Vagrant et VirtualBox pour faire tourner cet
environnement permet en théorie un même fonctionnement quelque soit
votre système d'exploitation Linux, MacOSX, Windows (à condition qu'il soit relativement
récent). Consultez cependant attentivement la section <a href="#sec-3-1">Prérequis</a>.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Compétences requises</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Bien que cet environnement techniquement basé sur une machine virtuelle Linux, aucune
compétence en <i>administration système</i> Unix ne devrait être nécessaire
pour pouvoir l'utiliser: l'interaction se déroulera principalement 
<b>dans l'interface Web</b> de votre navigateur, au moins pour les premiers TPs.
</p>

<p>
Cet environnement basé sur des logiciels libres est redistribuable, et
potentiellement réutilisable dans d'autre contextes, par exemple pour
votre utilisation professionelle, au-delà de ce MOOC (cf. <a href="#sec-6">À propos de la Box Vagrant du MOOC</a>).
</p>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Avertissement</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<i>Nous avons fait de notre mieux pour fournir un environnement fonctionnel, basé sur des logiciels libres, mais vous l'utilisez <b>à vos risques et périls, sans aucune garantie</b>. Nous ne pouvons être tenus responsables des dommages qui résulteraient de l'utilisation de cet environnement.</i>
</p>

<p>
L'ensemble des sources de cet environnement sont disponibles en
logiciel libre sur XXX (sous licences XXX).
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Glossaire</h3>
<div class="outline-text-3" id="text-2-4">
<dl class="org-dl">
<dt> box </dt><dd>paquetage d'installation d'une <i>machine virtuelle</i>
préconfigurée, qui est pris en charge par l'application
<i>Vagrant</i>. Les différentes versions des box sont publiées sur
Internet (sur <code>https://vagrantcloud.com/</code>), afin de faciliter
leur mise-à-jour.
</dd>
<dt> exerciseur </dt><dd>application destinée à faciliter l'apprentissage
</dd>
<dt> guest </dt><dd>voir <i>machine virtuelle</i>
</dd>
<dt> hôte </dt><dd>votre machine, avec un système d'exploitation, sur
laquelle est installé le virtualiseur <i>VirtualBox</i> utilisé par
<i>Vagrant</i> (c'est par exemple votre système <i>Windows 7</i> habituel).
</dd>
<dt> machine virtuelle </dt><dd>un système d'exploitation <i>virtualisé</i> (ici un
<i>Linux</i> sur une machine fictive ayant 2.5 Go de disque et 256 Mo de
RAM), qui est donc isolé des autres programmes de votre système
<i>hôte</i>. Nous l'avons préinstallé avec différents
logiciels. VirtualBox et Vagrant font fonctionner cette machine virtuelle:
démarrage, arrêt, mise en pause, etc.
</dd>
<dt> VM </dt><dd><i>Virtual Machine</i> voir <i>machine virtuelle</i>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Installation</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Prérequis</h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Disposer d'une machine moderne avec un système d'exploitation 64
bits (ou 32 bits<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>) sur lequel VirtualBox&trade; fonctionne<sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup>
</li>

<li>Avoir un environnement internet à haut débit, le temps de télécharger l'environnement<sup><a id="fnr.3" name="fnr.3" class="footref" href="#fn.3">3</a></sup>
</li>

<li>Avoir au moins 2 Go de libre sur un disque dur local
</li>

<li>Maîtriser un minimum l'utilisation d'un système d'exploitation,
notamment en mode invite de commande (commandes de base DOS ou shell
Unix, type <code>cd</code>, <code>ls/dir</code>, etc.).
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Télécharger et installer Vagrant et VirtualBox</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Téléchargez les deux applications depuis leurs sites, ou installez les
paquetages pour votre distribution (si vous êtes sur Linux).
</p>

<ul class="org-ul">
<li>Vagrant : <a href="http://www.vagrantup.com/downloads.html">http://www.vagrantup.com/downloads.html</a>
</li>
<li>VirtualBox : <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Initialisation et mise en route</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Choisir un dossier de travail dans lequel Vagrant va installer une
<b>machine virtuelle</b>, et où les fichiers des TPs vont résider. Ce dossier
doit être choisi sur une partition disposant d'au moins 2 Go d'espace de
stockage libre.
</p>


<p>
Pour télécharger la <i>box</i> Vagrant et procéder au premier lancement de de la <i>machine virtuelle</i>, suivre les étapes suivantes :
</p>

<ol class="org-ol">
<li>ouvrir un invite de commande<sup><a id="fnr.4" name="fnr.4" class="footref" href="#fn.4">4</a></sup> dans le dossier de travail choisi (utiliser <code>cd</code> pour s'y positionner):
</li>

<li>entrer la commande suivante : 
<pre class="example">
vagrant init oberger/moocbdvm
</pre>
<p>
un fichier <code>Vagrantfile</code> est créé dans le dossier de travail;
</p>
</li>

<li>entrer la commande suivante :
<pre class="example">
vagrant up
</pre>
<p>
ceci va télécharger la dernière version de la <a href="https://vagrantcloud.com/oberger/moocbdvm"><i>box</i> <code>oberger/moocbdvm</code></a> depuis Internet
(env. 350 Mo), et démarrer une machine virtuelle VirtualBox
en tâche de fond, qui fournira l'environnement Web que vous allez utiliser.
</p>
</li>
</ol>

<p>
<b>ATTENTION: La mise en place peut être longue et prendre du temps sur les machines peu puissantes et/ou ne disposant pas d'une connexion internet haut-débit.</b>
</p>

<p>
La mise en place est terminée quand s'affiche la ligne "<i>Successfully created the virtual machine.</i>". Si tout va bien, la machine virtuelle
est visible dans l'interface d'administration de VirtualBox (et peut
être démarrée, arrêtée, ou mise en pause comme une machine virtuelle
ordinaire).
</p>

<p>
Pour une explication des commandes de base de Vagrant,
consultez
<a href="http://docs.vagrantup.com/v2/getting-started/index.html">le guide de démarrage vagrant (en anglais)</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Utilisation</h2>
<div class="outline-text-2" id="text-4">
<p>
La machine virtuelle doit être lancée, en tâche de fond, pour pouvoir
utiliser l'environnement de travail personnel du MOOC. 
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Lancement de la machine virtuelle</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li>ouvrir un invite de commande dans le dossier de travail;
</li>

<li>entrer la commande:
<pre class="example">
vagrant up
</pre>
<p>
la mise en place de la machine est finie quand s'affiche la ligne "&#x2026;". Si la machine virtuelle était déjà lancée, rien ne se passe, tant mieux.
</p>
</li>
</ol>

<p>
Une fois lancée, elle fournit un serveur HTTP qui est redirigé sur
l'adresse locale de l'ordinateur <i>hôte</i> <code>localhost</code> (<code>127.0.0.1</code>), qui
écoute sur le port <code>8080</code> (d'où les URLs ci-dessous commençant par <code>http://localhost:8080/</code>).
</p>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Accès aux applications pour les TPs</h3>
<div class="outline-text-3" id="text-4-2">
</div><div id="outline-container-sec-4-2-1" class="outline-4">
<h4 id="sec-4-2-1">Exerciseur de requêtes SQL</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
Une fois la machine virtuelle lancée, ouvrir un navigateur Web et aller sur <a href="http://localhost:8080/bdsqlwiz/appli/">http://localhost:8080/bdsqlwiz/appli/</a>
</p>

<p>
Vous pouvez maintenant commencer votre apprentissage du langage SQL !
</p>
</div>
</div>

<div id="outline-container-sec-4-2-2" class="outline-4">
<h4 id="sec-4-2-2">Module Web d'administration PostgreSQL <i>phpPgAdmin</i></h4>
<div class="outline-text-4" id="text-4-2-2">
<ul class="org-ul">
<li>Connectez votre navigateur à l'adresse :
<a href="http://localhost:8080/phppgadmin/">http://localhost:8080/phppgadmin/</a>
</li>

<li>Connectez-vous au <i>Serveur</i> <code>PostgreSQL</code> :

<ul class="org-ul">
<li>User : <code>pg_reader</code>
</li>

<li>Password : <code>tpinfint</code>
</li>
</ul>
</li>
</ul>

<p>
Vous pouvez désormais saisir des requêtes SQL (de consultation seulement) sur le serveur PostgreSQL.
</p>
</div>
</div>

<div id="outline-container-sec-4-2-3" class="outline-4">
<h4 id="sec-4-2-3">En ligne de commande PostgreSQL</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
Pour exécuter des commandes SQL sur le serveur PostgreSQL présent à l'interieur de la machine virtuelle, procéder comme suit :
</p>

<ol class="org-ol">
<li>connectez-vous dans la machine virtuelle dans le compte <code>vagrant</code>
<pre class="example">
vagrant ssh
</pre>
<p>
vous devriez alors voir le <i>prompt</i> du shell Linux (si un client SSH est disponible &#x00ad;&#x2013; Cf. <a href="#sec-5-7">FAQ</a>), quelque chose du style :
</p>
<pre class="example">
Linux localhost 3.14-2-amd64 #1 SMP Debian 3.14.13-2 (2014-07-24) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Aug 13 13:27:54 2014 from 10.0.2.2
vagrant@localhost:~$
</pre>
</li>

<li>lancez la commande de connexion à PostgreSQL en ligne de commande (connexion à la base <code>vins</code> en tant qu'utilisateur PostgreSQL <code>pg_reader</code> :
<pre class="example">
psql -U pg_reader vins
</pre>
<p>
vous devriez alors voir le <i>prompt</i> de l'interface ligne de commandes de PostgreSQL.
</p>
<pre class="example">
psql (9.4beta2)
Saisissez « help » pour l'aide.

vins=&gt;
</pre>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-4-2-4" class="outline-4">
<h4 id="sec-4-2-4">Faire des mises à jour dans la base de données</h4>
<div class="outline-text-4" id="text-4-2-4">
<p>
Utilisez l'application Web <i>phppgadmin</i> (voir <a href="#sec-4-2-2">ci-dessus</a>), avec l'utilisateur <code>postgres</code>,
l'administrateur PostgreSQL qui a tous les droits sur la base de
données. Son mot-de-passe est aussi <code>postgres</code>.
</p>

<p>
Bien entendu, tout est possible quand on est administrateur, donc
attention avant de tout casser.
</p>
</div>
</div>

<div id="outline-container-sec-4-2-5" class="outline-4">
<h4 id="sec-4-2-5"><span class="todo TODO">TODO</span> Programmation Web / BD en PHP</h4>
<div class="outline-text-4" id="text-4-2-5">
<p>
Un sous-répertoire "<code>TP/</code>" est créé dans le répertoire dans lequel
vous avez lancé la création de la machine virtuelle.
</p>

<p>
Vous pouvez faire un <code>git pull</code> dans ce répertoire.
</p>

<p>
Le résultat est accessible sur <a href="http://localhost:8080/TP/">http://localhost:8080/TP/</a>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> FAQ</h2>
<div class="outline-text-2" id="text-5">
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> <span class="todo TODO">TODO</span> Si je n'ai que VirtualBox, puis-je me passer de l'installation de Vagrant ?</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Il est possible de télécharger une <i>box</i> Vagrant (fichier <code>.box</code>) et
d'en extraire le contenu (c'est en réalité une archive <i>tar</i>
compressée, équivalente à un <code>.tgz</code> / <code>.tar.gz</code>). Par exemple, sous
Unix : <code>tar zxf package.box</code>.
</p>


<p>
On peut en extraire un fichier de définition de machine virtuelle
VirtualBox (<code>./box.ovf</code>), ainsi que le fichier d'image de disque
(<code>./box-disk1.vmdk</code>) correspondant.
</p>

<p>
Il est alors possible d'importer le tout dans VirtualBox, et de
redéfinir les redirections de ports appropriées, ou les partages de
dossiers, etc.
</p>
</div>

<div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1">Je n'arrive pas à me connecter depuis la console affichée par VirtualBox</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
Attention : le clavier configuré par défaut, pour la console de login
affichée par VirtualBox est en disposition <b>azerty</b> (comme rappelé par
le message d'accueil affiché avant le prompt de <i>login</i>).
</p>

<p>
Une alternative à l'utilisation de la console affichée par VirtualBox,
est d'utiliser <code>vagrant ssh</code>, qui fonctionnera en principe quelque
soit votre disposition de clavier.
</p>
</div>
</div>

<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2">Comment installer un environnement de bureau sur la VM</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
Normalement, vous n'aurez pas besoin d'utiliser la machine virtuelle en mode bureau graphique pour les TPs du MOOC, mais c'est cependant tout-à-fait faisable.
</p>

<p>
Nous fournissons un script de mise-à-jour permettant d'installer (en
mode superutilisateur Linux) l'environnement de bureau XFCE4,
préconfiguré en français avec clavier azerty : <code>/usr/local/sbin/install-gui.sh</code>.
</p>

<p>
Pour le lancer, rentrer la commande suivante :
</p>
<pre class="example">
vagrant ssh -c "sudo /usr/local/sbin/install-gui.sh"
</pre>

<p>
Attention, ceci fait augmenter substentiellement l'occupation disque de la machine virtuelle.
</p>
</div>
</div>

<div id="outline-container-sec-5-1-3" class="outline-4">
<h4 id="sec-5-1-3"><span class="todo TODO">TODO</span> Comment installer l'application exerciseur manuellement</h4>
<div class="outline-text-4" id="text-5-1-3">
<p>
Les sources sont disponibles depuis git avec : 
git clone <a href="http://fusionforge.int-evry.fr/anonscm/git/bdsqlwiz/bdsqlwiz.git">http://fusionforge.int-evry.fr/anonscm/git/bdsqlwiz/bdsqlwiz.git</a>
</p>

<p>
TBD : archive extractible .zip, dans
<a href="https://fusionforge.int-evry.fr/frs/?group_id=64">https://fusionforge.int-evry.fr/frs/?group_id=64</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> J'ai un système 32 bits, est-ce que ça marchera pour moi ?</h3>
<div class="outline-text-3" id="text-5-2">
<p>
La version canonique sur laquelle nous avons basé nos réalisations et
nos tests de VM est la version 64 bits (architecture Linux <code>amd64</code>), qui
nécessite un hôte 64 bits.
</p>

<p>
Nous mettons également à votre disposition une version 32 bits, mais ayant fait
l'objet de tests moins poussés. 
</p>

<p>
Pour l'utiliser, remplacer
<code>oberger/moocbdvm</code> par <b><code>oberger/moocbdvm32</code></b> dans les instructions
<code>vagrant init</code>.
</p>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Je n'ai pas accès à Internet en haut débit</h3>
<div class="outline-text-3" id="text-5-3">
<p>
C'est bien dommage (d'autant que visionner les vidéos du MOOC doit
être pénible, dans ce cas). Cependant, vous pouvez installer de façon
indépendantes, les applications que nous avons empaquetées dans la
<i>box</i>.
</p>

<p>
Notez tout d'abord qu'un environnement d'exerciseur est disponible
aussi pour les navigateurs basés sur Webkit (Chrome, Safari), sans
nécessiter l'installation d'un SGBD comme PostgreSQL. (Cf. XXX - TODO)
</p>

<p>
Autrement, pas besoin de machine virtuelle, si vous savez installer un
SGBD par vous-même. Si vous avez la possibilité de créer une base de
données PostgreSQL localement, les scripts de création de base sont
disponibles dans XXX TODO.
</p>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Le message de confirmation de mise en place ne s'affiche pas.</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Reprendre les instuctions d'installation depuis le début en vérifiant que toutes les étapes ont été correctement suivies.
</p>

<p>
Il peut être nécessaire de mettre à jour la box (commandes <code>vagrant box outdated</code>, etc.). Veuillez vous reporter à la documentation Vagrant.
</p>

<p>
Si le problème persiste, contactez-nous via les forums du MOOC.
</p>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Quand j'utilise la commande <code>vagrant up</code>, je vois de nombreuses lignes "default: Warning: Connection timeout. Retrying&#x2026;" ou "default: Warning: Remote connection disconnect. Retrying&#x2026;"</h3>
<div class="outline-text-3" id="text-5-5">
<p>
Tout d'abord, ces lignes sont tout à fait normales si leur nombre est peu élevé et correspondent au temps de démarrage de la machine.
</p>

<p>
Si l'invite de commande en est rempli, il est conseillé d'interrompre
la commande (ctrl-C sur UNIX, XXX sur windows) et de recommencer
l'étape d'installation que vous faisiez.
</p>
</div>
</div>

<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> <span class="todo TODO">TODO</span> Si le binding de port ne fonctionne pas, que faire (rerédiger en fonction du message d'erreur réel)</h3>
<div class="outline-text-3" id="text-5-6">
<p>
TBD
</p>

<p>
Le démarrage de la machine virtuelle effectue une redirection du port
80 du <i>guest</i> vers le port 8080 de l'<i>hôte</i>. Il se peut qu'une telle
redirection soit interdite (firewall) ou impossible (une autre
application de l'hôte utilise déjà le port 8080).
</p>

<p>
Il est alors possible de modifier le fichier <code>Vagrantfile</code> (qui a été
généré dans le dossier de travail par <code>vagrant init</code>) pour utiliser un
autre port, par exemple 8081. Il faudra alors adapter toutes les URLs
pour utiliser à la place <code>http://localhost:8081</code>
</p>
</div>
</div>

<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> <code>vagrant ssh</code> échoue, sous Windows</h3>
<div class="outline-text-3" id="text-5-7">
<p>
En plus de l'installation de Vagrant et VirtualBox, il est nécessaire
d'installer un client SSH que Vagrant pourra utiliser pour se
connecter (avec une clé privée particulière) de façon transparente à
l'intérieur du <i>guest</i>.
</p>

<p>
Sur les systèmes Windows, il est probable qu'aucun client SSH ne sera
installé par défaut.
</p>

<p>
Ceci est une FAQ Vagrant, pour laquelle de nombreuses ressources
Internet sont disponibles. Contactez les forums du MOOC si vous n'y
arrivez pas par vous-même.
</p>
</div>
</div>

<div id="outline-container-sec-5-8" class="outline-3">
<h3 id="sec-5-8"><span class="section-number-3">5.8</span> Comment me connecter via SSH à la VM vagrant</h3>
<div class="outline-text-3" id="text-5-8">
<p>
Normalement, la commande <code>vagrant ssh</code> permet de faire cela de façon
transparente.
</p>

<p>
Sinon, n'importe quel client SSH fera l'affaire : se connecter avec
l'utilisateur <code>vagrant</code> et le mot-de-passe <code>vagrant</code> sur le port 2222
de l'<i>hôte</i> (redirigé vers le port 22 du <i>guest</i>) : <code>ssh -p 2222 vagrant@localhost</code> (mot de passe : <code>vagrant</code>)
</p>
</div>
</div>


<div id="outline-container-sec-5-9" class="outline-3">
<h3 id="sec-5-9"><span class="section-number-3">5.9</span> <span class="todo TODO">TODO</span> J'ai écrasé la base de données, que faire</h3>
</div>

<div id="outline-container-sec-5-10" class="outline-3">
<h3 id="sec-5-10"><span class="section-number-3">5.10</span> Si j'ai déjà un autre virtualiseur, puis-je convertir la VM ?</h3>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> À propos de la Box Vagrant du MOOC</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Architecture technique</h3>
<div class="outline-text-3" id="text-6-1">
<p>
La machine virtuelle déployée par la <i>box</i> Vagrant est basée sur un
système GNU/Linux (<a href="http://www.debian.org/">Debian</a> <i>jessie</i>).
</p>

<p>
Nous avons essayé de le rendre aussi léger que possible, mais portable
sur tout système cible récent dans lequel le gestionnaire de
machines virtuelles VirtualBox est disponible (couple Vagrant et VirtualBox).
</p>

<p>
La fabrication de la box Vagrant repose sur l'utilisation de
<a href="http://andsens.github.io/bootstrap-vz/">bootstrap-vz</a> pour l'installation du système Debian de base, complétée
par des scripts de <i>provisionning</i> que nous avons développés
(disponibles sur &#x2026;)
</p>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Utilité dans des contextes différents</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Bien que les exemples du cours soit relativement simples, nous avons
essayé de nous baser, pour cet environnement, sur une solution
réaliste utilisée dans le monde professionnel (Debian, PostreSQL,
phpPgAdmin, etc.).
</p>

<p>
Si la solution de virtualisation choisie ne convient pas à vos
contraintes, mais que vous avez installé un autre environnement
PostgreSQL + Apache/PHP, il est toujours possible d'installer
manuellement l'application d'exerciseur que nous avons développée,
mais nous ne pouvons nous engager à fournir un support sur celle-ci.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Copyright</h2>
<div class="outline-text-2" id="text-7">
<p>
<i>This document is (C) Copyright 2014 by Stephane Germain and Institut Mines-Telecom and is licensed under a</i> <a href="http://creativecommons.org/licenses/by-sa/4.0/"><i>Creative Commons Attribution-ShareAlike 4.0 International License</i></a>.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Notes de bas de page: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
Si votre système n'est pas 64 bits, attention, certaines
commandes devront être modifiées pour télécharger la bonne version de
la box Vagrant. Cf . <a href="#sec-5-2">J'ai un système 32 bits, est-ce que ça marchera pour moi ?</a>.
</p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p class="footpara">
Nous avons réalisé nos tests sur des ordinateurs portables
professionnels en systèmes GNU/Linux ou Microsoft Windows 7
professional.
</p></div>

<div class="footdef"><sup><a id="fn.3" name="fn.3" class="footnum" href="#fnr.3">3</a></sup> <p class="footpara">
Une fois l'installation de la box réalisée, l'utilisation de la machine virtuelle se fait en local, sans avoir besoin d'une connexion internet.
</p></div>

<div class="footdef"><sup><a id="fn.4" name="fn.4" class="footnum" href="#fnr.4">4</a></sup> <p class="footpara">
autrement appelé <i>terminal</i>, <i>shell</i>, selon les systèmes d'exploitation
</p></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Auteur: Stéphane Germain, Olivier Berger</p>
<p class="date">Date: 2014-08-14 jeu. 10:16</p>
<p class="creator">Copyright (C) 2014, The authors and Institut Mines-Télécom</p>
</div>
</body>
</html>
